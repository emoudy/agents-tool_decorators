# Core agent classes and main agent logic